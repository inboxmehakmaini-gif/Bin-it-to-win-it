<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Waste Manager</title>
    <style>
        :root { --sky: #b3e5fc; --grass: #a2d149; --org: #8bc34a; --haz: #e53935; --rec: #fdd835; --non: #1e88e5; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { margin: 0; font-family: 'Arial Rounded MT Bold', sans-serif; background: linear-gradient(to bottom, var(--sky) 0%, #ffffff 50%, var(--grass) 100%); overflow: hidden; touch-action: none; height: 100vh; width: 100vw; }
        
        #game-box { position: relative; width: 100%; height: 100%; z-index: 1; }
        
        /* UI Elements */
        .stats { position: absolute; top: 15px; width: 100%; display: flex; justify-content: space-around; z-index: 2000; font-weight: bold; color: #333; font-size: 1.2rem; }
        
        #feedback-text { position: absolute; top: 30%; left: 50%; transform: translateX(-50%); font-size: 2rem; font-weight: bold; z-index: 3000; opacity: 0; transition: opacity 0.2s; pointer-events: none; text-shadow: 2px 2px 4px rgba(0,0,0,0.2); }
        .correct { color: #2e7d32; }
        .incorrect { color: #d32f2f; }

        /* Bins */
        .bin-row { position: absolute; bottom: 20px; width: 100%; display: flex; justify-content: space-evenly; align-items: flex-end; padding: 0 5px; z-index: 10; }
        .bin-container { display: flex; flex-direction: column; align-items: center; width: 23%; }
        .bin { width: 100%; height: 80px; border-radius: 0 0 10px 10px; position: relative; display: flex; justify-content: center; align-items: center; font-size: 24px; box-shadow: inset -5px 0 10px rgba(0,0,0,0.1); }
        .bin::after { content: ''; position: absolute; top: -10px; width: 110%; height: 12px; background: inherit; filter: brightness(1.1); border-radius: 5px; box-shadow: 0 2px 4px rgba(0,0,0,0.2); }
        .label { font-size: 9px; font-weight: bold; margin-top: 15px; color: #1b3a00; text-transform: uppercase; text-align: center; }

        /* Items - FORCING VISIBILITY */
        .item { position: absolute; width: 70px; height: 70px; display: flex; justify-content: center; align-items: center; font-size: 50px; z-index: 1500 !important; cursor: move; touch-action: none; filter: drop-shadow(0 4px 6px rgba(0,0,0,0.3)); visibility: visible !important; }

        /* Screens */
        .overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.8); display: flex; justify-content: center; align-items: center; z-index: 5000; }
        .modal { background: white; padding: 30px; border-radius: 25px; width: 85%; text-align: center; max-width: 400px; }
        .modal h1 { color: #ff9800; margin: 0 0 15px 0; }
        .instructions { background: #f0f7ff; border: 1px solid #c2e0ff; padding: 15px; border-radius: 15px; text-align: left; margin-bottom: 20px; font-size: 0.9rem; }
        
        input { padding: 12px; width: 90%; border-radius: 10px; border: 2px solid #ddd; margin-bottom: 20px; font-size: 1rem; text-align: center; }
        .btn { background: #ff9800; color: white; border: none; padding: 15px 30px; border-radius: 30px; font-size: 1.2rem; font-weight: bold; cursor: pointer; box-shadow: 0 4px 0 #e65100; }
        .hidden { display: none !important; }
    </style>
</head>
<body>

<div id="game-box">
    <div id="feedback-text"></div>
    <div class="stats">
        <div>‚≠ê <span id="score-val">0</span></div>
        <div id="lives-val">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</div>
    </div>

    <div class="bin-row">
        <div class="bin-container"><div id="org" class="bin" style="background:var(--org)">üçÉ</div><div class="label">Organic</div></div>
        <div class="bin-container"><div id="haz" class="bin" style="background:var(--haz)">üíÄ</div><div class="label">Hazardous</div></div>
        <div class="bin-container"><div id="rec" class="bin" style="background:var(--rec)">‚ôªÔ∏è</div><div class="label">Recyclable</div></div>
        <div class="bin-container"><div id="non" class="bin" style="background:var(--non)">üöÆ</div><div class="label">Non-Recycle</div></div>
    </div>

    <div id="start-screen" class="overlay">
        <div class="modal">
            <h1>Eco-Sort!</h1>
            <div class="instructions">
                <strong>How to Play:</strong><br>
                1. Drag the falling waste items.<br>
                2. Drop them into the matching bin below.<br>
                3. Don't let waste hit the ground!
            </div>
            <input type="text" id="user-name" placeholder="Enter Your Name" maxlength="10">
            <button class="btn" onclick="play()">START MISSION</button>
        </div>
    </div>

    <div id="end-screen" class="overlay hidden">
        <div class="modal">
            <h2>Mission Over</h2>
            <p id="final-score" style="font-size:1.5rem; font-weight:bold;"></p>
            <div id="lb" style="text-align: left; background: #f5f5f5; padding: 10px; border-radius: 10px; font-size: 0.9rem; margin-bottom: 20px;">Saving score...</div>
            <button class="btn" onclick="location.reload()">RETRY</button>
        </div>
    </div>
</div>

<script>
    const URL = "https://script.google.com/macros/s/AKfycby4Oauf9hlaGeRFLOR5rT6SBdomtLCqvDbH1O_upWWxclHjJop3_EctZ-oUpMXERXzO/exec";
    let score = 0, lives = 5, isRunning = false;
    const trash = [
        {e:'üçé', t:'org'}, {e:'üçå', t:'org'}, {e:'üçï', t:'org'},
        {e:'üîã', t:'haz'}, {e:'üß™', t:'haz'},
        {e:'üì∞', t:'rec'}, {e:'ü•´', t:'rec'},
        {e:'üö¨', t:'non'}, {e:'ü•§', t:'non'}
    ];

    function play() {
        document.getElementById('start-screen').classList.add('hidden');
        isRunning = true;
        spawn();
    }

    function showFeedback(text, isCorrect) {
        const fb = document.getElementById('feedback-text');
        fb.innerText = text;
        fb.className = isCorrect ? 'correct' : 'incorrect';
        fb.style.opacity = '1';
        setTimeout(() => { fb.style.opacity = '0'; }, 800);
    }

    function spawn() {
        if(!isRunning) return;
        const info = trash[Math.floor(Math.random() * trash.length)];
        const el = document.createElement('div');
        el.className = 'item';
        el.innerHTML = info.e;
        el.style.left = (Math.random() * (window.innerWidth - 80)) + "px";
        el.style.top = "-80px";
        document.getElementById('game-box').appendChild(el);

        let y = -80;
        let isDragging = false;

        const fall = setInterval(() => {
            if(!isRunning) { clearInterval(fall); el.remove(); return; }
            if(!isDragging) {
                y += 2 + (score / 600);
                el.style.top = y + "px";
                if(y > window.innerHeight - 130) {
                    clearInterval(fall); el.remove();
                    showFeedback("Missed! ‚ùå", false);
                    lose();
                }
            }
        }, 20);

        el.onpointerdown = (e) => { isDragging = true; el.setPointerCapture(e.pointerId); };
        el.onpointermove = (e) => {
            if(isDragging) {
                el.style.left = (e.clientX - 35) + "px";
                el.style.top = (e.clientY - 35) + "px";
            }
        };
        el.onpointerup = (e) => {
            isDragging = false;
            const b = document.getElementById(info.t).getBoundingClientRect();
            const r = el.getBoundingClientRect();
            if(r.bottom > b.top && r.left < b.right && r.right > b.left) {
                score += 10;
                document.getElementById('score-val').innerText = score;
                showFeedback("Great! ‚úÖ", true);
                clearInterval(fall); el.remove();
            }
        };
        setTimeout(spawn, Math.max(1000, 2800 - (score * 2.5)));
    }

    function lose() {
        lives--;
        document.getElementById('lives-val').innerText = "‚ù§Ô∏è".repeat(lives) + "üñ§".repeat(5-lives);
        if(lives <= 0) {
            isRunning = false;
            document.getElementById('end-screen').classList.remove('hidden');
            document.getElementById('final-score').innerText = "Final Score: " + score;
            save();
        }
    }

    async function save() {
        const name = document.getElementById('user-name').value || "Player";
        try {
            await fetch(URL, {method:"POST", mode:"no-cors", body: JSON.stringify({name:name, score:score})});
            const res = await fetch(URL);
            const data = await res.json();
            let h = "<b>Leaderboard:</b><br>";
            data.slice(0,5).forEach((r, i) => h += (i+1) + ". " + r[0] + ": " + r[1] + "<br>");
            document.getElementById('lb').innerHTML = h;
        } catch(e) { document.getElementById('lb').innerText = "Score recorded!"; }
    }
</script>
</body>
</html>
